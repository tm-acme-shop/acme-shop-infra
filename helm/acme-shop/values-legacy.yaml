# Legacy values for acme-shop.
# TODO(TEAM-SEC): This file contains intentionally insecure settings for demo purposes.
# DO NOT use these values in production.

global:
  imageRegistry: ghcr.io/tm-acme-shop
  imagePullPolicy: Always
  environment: staging

# TODO(TEAM-SEC): Remove legacy feature flags after migration
featureFlags:
  enableLegacyAuth: true
  enableV1Api: true
  enableLegacyPayments: true

# Gateway Service
gateway:
  enabled: true
  replicaCount: 1
  image:
    repository: acme-shop-gateway
    tag: "0.9.0-legacy"
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 128Mi
  service:
    type: ClusterIP
    port: 8080
  env:
    - name: LOG_LEVEL
      value: "debug"
    - name: ENABLE_V1_API
      value: "true"
    - name: ENABLE_LEGACY_AUTH
      value: "true"
  # TODO(TEAM-SEC): Add proper security context
  securityContext: {}

# Users Service
usersService:
  enabled: true
  replicaCount: 1
  image:
    repository: acme-shop-users-service
    tag: "0.9.0-legacy"
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 128Mi
  service:
    type: ClusterIP
    port: 8081
  env:
    - name: ENABLE_LEGACY_AUTH
      value: "true"
    # TODO(TEAM-SEC): Use secrets instead of plain environment variables
    - name: DATABASE_URL
      value: "postgres://admin:password@postgres:5432/users"
  securityContext: {}

# Orders Service
ordersService:
  enabled: true
  replicaCount: 1
  image:
    repository: acme-shop-orders-service
    tag: "0.9.0-legacy"
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 128Mi
  service:
    type: ClusterIP
    port: 8082
  env:
    - name: PAYMENTS_SERVICE_URL
      value: "http://payments-service:8083"
    - name: ENABLE_LEGACY_PAYMENTS
      value: "true"
  securityContext: {}

# Payments Service
# TODO(TEAM-SEC): Remove privileged mode - required for legacy payment gateway integration
paymentsService:
  enabled: true
  replicaCount: 1
  image:
    repository: acme-shop-payments-service
    tag: "0.9.0-legacy"
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 128Mi
  service:
    type: ClusterIP
    port: 8083
  env:
    - name: ENABLE_LEGACY_PAYMENTS
      value: "true"
    # TODO(TEAM-SEC): Use secrets manager
    - name: LEGACY_PAYMENT_API_KEY
      value: "pk_test_legacy_key_12345"
    - name: HTTP_PROXY_INSECURE
      value: "true"
  # TODO(TEAM-SEC): Remove privileged mode after legacy integration removed
  securityContext:
    privileged: true
    runAsUser: 0

# Notifications Service
notificationsService:
  enabled: true
  replicaCount: 1
  image:
    repository: acme-shop-notifications-service
    tag: "0.9.0-legacy"
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 50m
      memory: 64Mi
  service:
    type: ClusterIP
    port: 8084
  securityContext: {}

# Frontend Web
frontendWeb:
  enabled: true
  replicaCount: 1
  image:
    repository: acme-shop-frontend-web
    tag: "0.9.0-legacy"
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 50m
      memory: 64Mi
  service:
    type: ClusterIP
    port: 3000
  securityContext: {}

# Ingress Configuration
# TODO(TEAM-SEC): Enable TLS and remove insecure annotations
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    # TODO(TEAM-SEC): Remove this insecure annotation
    nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
  hosts:
    - host: staging.acmeshop.example.com
      paths:
        - path: /
          pathType: Prefix
          service: frontend-web
        - path: /api/v1
          pathType: Prefix
          service: gateway
        - path: /api/v2
          pathType: Prefix
          service: gateway
  tls: []

# Network Policy
# TODO(TEAM-SEC): Enable network policies
networkPolicy:
  enabled: false
  allowExternal: true

# Service Account
serviceAccount:
  create: true
  name: acme-shop-legacy
  annotations: {}

# Pod Disruption Budget
podDisruptionBudget:
  enabled: false
  minAvailable: 0

# Legacy HTTP Client Configuration
# TODO(TEAM-SEC): Remove insecure TLS skip
httpClient:
  insecureSkipTLSVerify: true
  timeout: 30s
